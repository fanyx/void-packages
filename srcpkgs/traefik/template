# Template file for 'traefik'
pkgname=traefik
version=3.4.1
revision=1
build_style=go
go_import_path="github.com/traefik/traefik/v3"
go_package="${go_import_path}/cmd/traefik"
short_desc="Cloud Native Application Proxy"
maintainer="Hendrik Boll <fanyx@posteo.net>"
license="MIT"
homepage="https://traefik.io/"
changelog="https://raw.githubusercontent.com/traefik/traefik/v${version}/CHANGELOG.md"
distfiles="https://github.com/traefik/traefik/archive/v${version}.tar.gz"
checksum=a15979c1593ba2d09e4210d698f6fc82bb1cbe9f856180ba7671d6d2b45cf5ba
conf_files="/etc/traefik/traefik.yml"
system_accounts="_traefik"

post_install() {
	vinstall traefik.sample.yml 644 /etc/traefik traefik.yml
	vlicense LICENSE.md
	vsv traefik
}

if [ "$XBPS_TARGET_MACHINE" = "i686" ]; then
	# Checks are broken on x86, as they expect float64 values and 64-bit atomic
	# operations
	# https://github.com/traefik/traefik/issues/11546
	make_check=no
fi

# v3/integration requires running docker daemon
pre_check() {
	make_check_target=$(go list ./... | grep -v github.com/traefik/traefik/v3/integration)
}
